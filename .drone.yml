matrix:
  VERSION:
    # - "1.4.2"
    - "1.5.3"
    - "1.6"
  FLAVOR:
    - "default"
    - "alpine"

publish:
  hub_1.4.2:
    image: armhfplugins/drone-docker:docker-caching
    file: "$$VERSION/Dockerfile"
    context: "$$VERSION"
    username: $$DOCKER_USER
    email: $$DOCKER_EMAIL
    password: $$DOCKER_PASSWORD
    repo: armhfbuild/golang
    tag:
      - "$$VERSION-alpine"
      - "1.4-alpine"
    force_tag: true
    when:
      matrix:
        VERSION: "1.4.2"
        FLAVOR: "default"

  hub_1.4.2-alpine:
    image: armhfplugins/drone-docker:docker-caching
    file: "$$VERSION/alpine/Dockerfile"
    context: "alpine/$$VERSION"
    username: $$DOCKER_USER
    email: $$DOCKER_EMAIL
    password: $$DOCKER_PASSWORD
    repo: armhfbuild/golang
    tag:
      - "1.4.2-alpine"
      - "1.4-alpine"
    force_tag: true
    when:
      matrix:
        VERSION: "1.4.2"
        FLAVOR: "alpine"

  hub_1.5.3:
    image: armhfplugins/drone-docker:docker-caching
    file: "$$VERSION/Dockerfile"
    context: "$$VERSION"
    username: $$DOCKER_USER
    email: $$DOCKER_EMAIL
    password: $$DOCKER_PASSWORD
    repo: armhfbuild/golang
    tag:
      - "1.5.3"
      - "1.5"
    force_tag: true
    when:
      matrix:
        VERSION: "1.5.3"
        FLAVOR: "default"

  hub_1.5.3-alpine:
    image: armhfplugins/drone-docker:docker-caching
    file: "$$VERSION/alpine/Dockerfile"
    context: "$$VERSION/alpine"
    username: $$DOCKER_USER
    email: $$DOCKER_EMAIL
    password: $$DOCKER_PASSWORD
    repo: armhfbuild/golang
    tag:
      - "1.5.3-alpine"
      - "1.5-alpine"
    force_tag: true
    when:
      matrix:
        VERSION: "1.5.3"
        FLAVOR: "alpine"

  hub_1.6:
    image: armhfplugins/drone-docker:docker-caching
    file: "$$VERSION/Dockerfile-$$FLAVOR"
    context: "$$VERSION"
    username: $$DOCKER_USER
    email: $$DOCKER_EMAIL
    password: $$DOCKER_PASSWORD
    repo: armhfbuild/golang
    force_tag: true
    storage_driver: overlay
    build_args:
      - GOLANG_VERSION=1.6
      - GOLANG_BIN_SHA256=4340efa4836a7ddfc61d00e396e0f496a5ca5cf8bc598dc3b5f50707e6107f59
    tag:
      - "1.6.0"
      - "1.6"
      - "1"
      - "latest"
    when:
      matrix:
        VERSION: "1.6"
        FLAVOR: "default"

  hub_1.6-alpine:
    image: armhfplugins/drone-docker:docker-caching
    file: "$$VERSION/Dockerfile-$$FLAVOR"
    context: "$$VERSION"
    username: $$DOCKER_USER
    email: $$DOCKER_EMAIL
    password: $$DOCKER_PASSWORD
    repo: armhfbuild/golang
    force_tag: true
    storage_driver: overlay
    build_args:
      - GOLANG_VERSION=1.6
      - ARCH=armv6l
      - GOLANG_SRC_SHA256=a96cce8ce43a9bf9b2a4c7d470bc7ee0cb00410da815980681c8353218dcf146
    tag:
      - "1.6.0-alpine"
      - "1.6-alpine"
      - "1-alpine"
      - "alpine"
    when:
      matrix:
        VERSION: "1.6"
        FLAVOR: "alpine"

cache:
  mount:
    - /drone/docker

notify:
  slack:
    webhook_url: $$SLACK_WEBHOOK_URL
    channel: armhf
